function BallManager(t,e,a,r,i){this.size=r,this.nColors=a,this.sprite=i,this.width=t,this.height=e,this.board=new Board(9,9,0),this.selectedBall=null,this.balls={},this.upcomingColors=[randInt(0,this.nColors),randInt(0,this.nColors),randInt(0,this.nColors)],this.ballPreview=[]}function Board(t,e,a){this.width=t,this.height=e,this.size=0,this.capacity=t*e,this["default"]=a,this.values=this.init(t,e,a)}function preload(){game.load.image("board","./res/tile.png"),game.load.image("sidebar","./res/sidebar.png"),game.load.image("shadow","./res/shadow.png"),game.load.image("restart","./res/restart.png"),game.load.spritesheet("balls","./res/balls.png",BALL_HEIGHT,BALL_HEIGHT),game.stage.backgroundColor="#607D8B"}function create(){initBoard(),easystar=new EasyStar.js,easystar.setGrid(manager.board.values),easystar.setAcceptableTiles([0]),game.add.sprite(450,0,"sidebar"),score.renderScore(530,game.world.centerY+5),score.renderHighScore(530,game.world.centerY+5-70),restartGame=game.add.sprite(game.width-125,game.height-30,"restart"),restartGame.inputEnabled=1,restartGame.events.onInputDown.add(function(){manager.reset(),score.reset(),randBallGroup()}),randBallGroup()}function ballListener(t){null!==manager.getSelectedBall()&&BallManager.Effects.removeShadow(manager.getSelectedBall()),manager.setSelectedBall(t),t.isMoving||BallManager.Effects.addShadow(t,"shadow")}function cellListener(t){var e=manager.atWhichCell(t.x,t.y),a=manager.selectedBall;if(null!==a&&!a.isMoving&&!manager.board.at(e.x,e.y)){var r=manager.atWhichCell(a.x,a.y);easystar.findPath(r.x,r.y,e.x,e.y,function(t){null!==t?manager.move(a,t,matchAndScore,[e.x,e.y]):console.log("No path was found."),manager.setSelectedBall(null)}),BallManager.Effects.removeShadow(a),easystar.calculate()}}function initBoard(){var t,e,a;for(t=0;NUM_ROWS>t;t++)for(e=0;NUM_ROWS>e;e++)a=game.add.sprite(t*BALL_HEIGHT,e*BALL_HEIGHT,"board"),a.inputEnabled=1,a.events.onInputDown.add(cellListener,this)}function matchAndScore(t,e){var a=manager.removeMatch(t,e);a>0?score.update(a):randBallGroup()}function randBallGroup(){for(var t=manager.renderUpcoming(ballListener),e=0;e<t.length;e++)BallManager.Effects.fadeIn(t[e]);manager.renderPreviews(530,game.height/2+70,.5,null)}function ScoreBoard(t,e,a,r){this.score=void 0===t?0:t,this.highscore=void 0===e?0:e,this.scoreText=null,this.highscoreText=null,this.fontSize=a,this.color=r}function randInt(t,e){return Math.floor(Math.random()*(e-t))+t}function pathFinding(){}BallManager.prototype.render=function(t,e,a,r){var i=game.add.sprite(t*this.size,e*this.size,this.sprite,a);return i.inputEnabled=1,i.color=a,i.isMoving=!1,i.events.onInputDown.add(r,this),this.board.add(t,e,1),this.balls[this.getName(t,e)]=i,i},BallManager.prototype.renderPreviews=function(t,e,a){this.clearPreviews();for(var r=0;3>r;r++){var i=this.upcomingColors[r];this.ballPreview[r]=game.add.sprite(t+25*r,e,this.sprite,i),this.ballPreview[r].color=i,this.ballPreview[r].scale.setTo(a,a)}},BallManager.prototype.renderUpcoming=function(t){for(var e=[],a=0;3>a;a++){var r=this.randLocation();e.push(this.render(r.x,r.y,this.upcomingColors.pop(),t)),this.removeMatch(r.x,r.y)}return this.newUpcomingColors(),e},BallManager.prototype.getSelectedBall=function(){return this.selectedBall},BallManager.prototype.setSelectedBall=function(t){return this.selectedBall=t},BallManager.prototype.move=function(t,e,a,r){var i=e.length-1,o=this.getName(e[0].x,e[0].y),n=this.getName(e[i].x,e[i].y);this.board.remove(e[0].x,e[0].y),this.board.add(e[i].x,e[i].y,1),this.balls[n]=this.balls[o],delete this.balls[o],t.isMoving=!0;for(var s=game.add.tween(t),l=0;l<e.length;l++)s.to({x:e[l].x*this.size,y:e[l].y*this.size},50,Phaser.Easing.Linear.None);s.start(),s.onComplete.add(function(){t.isMoving=!1,null!==a&&"function"==typeof a&&a.apply(this,r)})},BallManager.prototype.remove=function(t){if(null!==t&&void 0!==t){var e=this.atWhichCell(t.x,t.y);delete this.balls[this.getName(e.x,e.y)],this.board.remove(e.x,e.y),BallManager.Effects.fadeOut(t,t.kill)}},BallManager.prototype.horizontalMatch=function(t,e,a){for(var r=1,i=t+1,o=t-1;NUM_ROWS>i&&1===this.board.at(i,e)&&this.balls[this.getName(i,e)].color===a;)r++,i++;for(;o>=0&&1===this.board.at(o,e)&&this.balls[this.getName(o,e)].color===a;)r++,o--;if(r>=5){for(var n=o+1;i>n;n++)this.remove(this.balls[this.getName(n,e)]);return r}return 0},BallManager.prototype.verticalMatch=function(t,e,a){for(var r=1,i=e-1,o=e+1;NUM_ROWS>o&&1===this.board.at(t,o)&&this.balls[this.getName(t,o)].color===a;)r++,o++;for(;i>=0&&1===this.board.at(t,i)&&this.balls[this.getName(t,i)].color===a;)r++,i--;if(r>=5){for(var n=i+1;o>n;n++)this.remove(this.balls[this.getName(t,n)]);return r}return 0},BallManager.prototype.mainDiagonalMatch=function(t,e,a){for(var r=1,i=t+1,o=e-1,n=t-1,s=e+1;NUM_ROWS>i&&o>=0&&1===this.board.at(i,o)&&this.balls[this.getName(i,o)].color===a;)r++,i++,o--;for(;n>=0&&NUM_ROWS>s&&1===this.board.at(n,s)&&this.balls[this.getName(n,s)].color===a;)r++,n--,s++;if(r>=5){for(var l=n+1,h=s-1;i>l&&h>o;)this.remove(this.balls[this.getName(l,h)]),l++,h--;return r}return 0},BallManager.prototype.antiDiagonalMatch=function(t,e,a){for(var r=1,i=t-1,o=e-1,n=t+1,s=e+1;i>=0&&o>=0&&1===this.board.at(i,o)&&this.balls[this.getName(i,o)].color===a;)r++,i--,o--;for(;NUM_ROWS>n&&NUM_ROWS>s&&1===this.board.at(n,s)&&this.balls[this.getName(n,s)].color===a;)r++,n++,s++;if(r>=5){for(var l=n-1,h=s-1;l>i&&h>o;)this.remove(this.balls[this.getName(l,h)]),l--,h--;return r}return 0},BallManager.prototype.removeMatch=function(t,e){var a=this.balls[this.getName(t,e)].color;return this.horizontalMatch(t,e,a)+this.verticalMatch(t,e,a)+this.mainDiagonalMatch(t,e,a)+this.antiDiagonalMatch(t,e,a)},BallManager.prototype.reset=function(){for(var t=0;t<this.ballPreview.length;t++)this.ballPreview[t].kill();null!==this.getSelectedBall()&&(BallManager.Effects.removeShadow(this.getSelectedBall()),this.setSelectedBall(null));for(var e in this.balls)this.balls[e].kill(),delete this.balls[e];this.ballPreview=[],this.board.reset(),this.newUpcomingColors()},BallManager.prototype.randLocation=function(){var t=0,e=0;do t=randInt(0,9),e=randInt(0,9);while(1===this.board.at(t,e)&&!this.board.isFull());return{x:t,y:e}},BallManager.prototype.newUpcomingColors=function(){for(var t=0;3>t;t++)this.upcomingColors[t]=randInt(0,this.nColors)},BallManager.prototype.getBoard=function(){return this.board.getValues()},BallManager.prototype.isMoving=function(t){return null===t||void 0===t?!1:t.isMoving},BallManager.prototype.atWhichCell=function(t,e){return{x:Math.floor(t/this.size),y:Math.floor(e/this.size)}},BallManager.prototype.getName=function(t,e){return t+", "+e},BallManager.prototype.clearPreviews=function(){for(var t=0;t<this.ballPreview.length;t++)this.ballPreview[t].kill(),this.ballPreview[t]=null},BallManager.prototype.getColor=function(t){switch(t){case 0:return"RED";case 1:return"ORANGE";case 2:return"GREEN";case 3:return"BLUE";case 4:return"GREY";case 5:return"BROWN";case 6:return"LIME"}},BallManager.Effects=function(){},BallManager.Effects.fadeIn=function(t,e){t.alpha=0;var a=game.add.tween(t).to({alpha:1},1e3,Phaser.Easing.Linear.None,!0);a.onComplete.add(function(){null!==e&&void 0!==e&&"function"==typeof e&&e()})},BallManager.Effects.fadeOut=function(t,e){var a=game.add.tween(t).to({alpha:0},500,Phaser.Easing.Linear.None,!0);a.onComplete.add(function(){null!==e&&void 0!==e&&"function"==typeof e&&(e(),t.kill())})},BallManager.Effects.addShadow=function(t,e){if(null!==t){var a=game.add.sprite(t.x,t.y,e);a.alpha=0,game.add.tween(a).to({alpha:1},100,Phaser.Easing.Linear.None,!0),t.shadow=a}},BallManager.Effects.removeShadow=function(t){null!==t&&null!==t.shadow&&(t.shadow.kill(),t.shadow=null)},Board.prototype.init=function(t,e,a){var r,i,o=[];for(r=0;t>r;r++)for(o.push([]),i=0;e>i;i++)o[r].push(a);return o},Board.prototype.print=function(){for(var t="",e=0;e<this.width;e++){for(var a=0;a<this.height;a++)t+=this.at(e,a)+" ";t+="\n"}console.log(t)},Board.prototype.getValues=function(){return this.values},Board.prototype.at=function(t,e){return this.values[e][t]},Board.prototype.add=function(t,e,a){this.values[e][t]=a,this.size++},Board.prototype.remove=function(t,e){this.values[e][t]=this["default"],this.size--},Board.prototype.isFull=function(){return this.size>=this.capacity},Board.prototype.reset=function(){var t,e;for(t=0;t<this.width;t++)for(e=0;e<this.height;e++)this.remove(t,e);this.size=0};const NUM_BALLS=6,BALL_HEIGHT=50,SIDEBAR_WIDTH=200,NUM_ROWS=9;var game=new Phaser.Game(650,450,Phaser.CANVAS,"lines-color",{preload:preload,create:create}),score=new ScoreBoard(0,localStorage.highscore,15,color="#ffffff"),manager=new BallManager(NUM_ROWS,NUM_ROWS,NUM_BALLS,BALL_HEIGHT,"balls");ScoreBoard.prototype.reset=function(){this.score=0},ScoreBoard.prototype.renderScore=function(t,e){this.scoreText=game.add.text(t,e,this.score+""),this.scoreText.fontSize=this.fontSize,this.scoreText.fill=this.color},ScoreBoard.prototype.renderHighScore=function(t,e){this.highscoreText=game.add.text(t,e,this.highscore+""),this.highscoreText.fontSize=this.fontSize,this.highscoreText.fill=this.color},ScoreBoard.prototype.update=function(t){return null!=this.highscoreText&&null!=this.scoreText&&t>0&&(this.score+=10*t,this.scoreText.text=this.score+"",this.score>this.highscore&&(this.highscore=this.score,this.highscoreText.text=this.highscore+"",localStorage.highscore=this.highscore)),t>0};var EasyStar=EasyStar||{};"function"==typeof define&&define.amd&&define("easystar",[],function(){return EasyStar}),"undefined"!=typeof module&&module.exports&&(module.exports=EasyStar),EasyStar.Node=function(t,e,a,r,i){this.parent=t,this.x=e,this.y=a,this.costSoFar=r,this.simpleDistanceToTarget=i,this.bestGuessDistance=function(){return this.costSoFar+this.simpleDistanceToTarget}},EasyStar.Node.OPEN_LIST=0,EasyStar.Node.CLOSED_LIST=1,EasyStar.PriorityQueue=function(t,e){this.length=0;var a=[],r=!1;if(e==EasyStar.PriorityQueue.MAX_HEAP)r=!0;else{if(e!=EasyStar.PriorityQueue.MIN_HEAP)throw e+" not supported.";r=!1}this.insert=function(e){if(!e.hasOwnProperty(t))throw"Cannot insert "+e+" because it does not have a property by the name of "+t+".";a.push(e),this.length++,i(this.length-1)},this.getHighestPriorityElement=function(){return a[0]},this.shiftHighestPriorityElement=function(){if(0===this.length)throw"There are no more elements in your priority queue.";if(1===this.length){var t=a[0];return a=[],this.length=0,t}var e=a[0],r=a.pop();return this.length--,a[0]=r,o(0),e};var i=function(t){if(0!==t){var e=l(t);s(t,e)&&(n(t,e),i(e))}},o=function(t){var e=h(t),a=c(t);if(s(e,t))n(t,e),o(e);else if(s(a,t))n(t,a),o(a);else{if(0==t)return;o(0)}},n=function(t,e){var r=a[t];a[t]=a[e],a[e]=r},s=function(e,i){if(void 0===a[i]||void 0===a[e])return!1;var o,n;return"function"==typeof a[e][t]?(o=a[e][t](),n=a[i][t]()):(o=a[e][t],n=a[i][t]),r?o>n?!0:!1:n>o?!0:!1},l=function(t){return Math.floor(t/2)-1},h=function(t){return 2*t+1},c=function(t){return 2*t+2}},EasyStar.PriorityQueue.MAX_HEAP=0,EasyStar.PriorityQueue.MIN_HEAP=1,EasyStar.instance=function(){this.isDoneCalculating=!0,this.pointsToAvoid={},this.startX,this.callback,this.startY,this.endX,this.endY,this.nodeHash={},this.openList},EasyStar.js=function(){var t,e,a,r=10,i=14,o=!1,n={},s={},l={},h=!0,c=[],u=Number.MAX_VALUE,d=!1;this.setAcceptableTiles=function(t){t instanceof Array?a=t:!isNaN(parseFloat(t))&&isFinite(t)&&(a=[t])},this.enableSync=function(){o=!0},this.disableSync=function(){o=!1},this.enableDiagonals=function(){d=!0},this.disableDiagonals=function(){d=!1},this.setGrid=function(e){t=e;for(var a=0;a<t.length;a++)for(var r=0;r<t[0].length;r++)s[t[a][r]]||(s[t[a][r]]=1)},this.setTileCost=function(t,e){s[t]=e},this.setAdditionalPointCost=function(t,e,a){l[t+"_"+e]=a},this.removeAdditionalPointCost=function(t,e){delete l[t+"_"+e]},this.removeAllAdditionalPointCosts=function(){l={}},this.setIterationsPerCalculation=function(t){u=t},this.avoidAdditionalPoint=function(t,e){n[t+"_"+e]=1},this.stopAvoidingAdditionalPoint=function(t,e){delete n[t+"_"+e]},this.enableCornerCutting=function(){h=!0},this.disableCornerCutting=function(){h=!1},this.stopAvoidingAllAdditionalPoints=function(){n={}},this.findPath=function(e,i,n,s,l){var h=function(t){o?l(t):setTimeout(function(){l(t)})};if(void 0===a)throw new Error("You can't set a path without first calling setAcceptableTiles() on EasyStar.");if(void 0===t)throw new Error("You can't set a path without first calling setGrid() on EasyStar.");if(0>e||0>i||0>n||0>n||e>t[0].length-1||i>t.length-1||n>t[0].length-1||s>t.length-1)throw new Error("Your start or end point is outside the scope of your grid.");if(e===n&&i===s)return void h([]);for(var u=t[s][n],d=!1,f=0;f<a.length;f++)if(u===a[f]){d=!0;break}if(d===!1)return void h(null);var g=new EasyStar.instance;g.openList=new EasyStar.PriorityQueue("bestGuessDistance",EasyStar.PriorityQueue.MIN_HEAP),g.isDoneCalculating=!1,g.nodeHash={},g.startX=e,g.startY=i,g.endX=n,g.endY=s,g.callback=h,g.openList.insert(y(g,g.startX,g.startY,null,r)),c.push(g)},this.calculate=function(){if(0!==c.length&&void 0!==t&&void 0!==a)for(e=0;u>e;e++){if(0===c.length)return;if(o&&(e=0),0!==c[0].openList.length){var n=c[0].openList.shiftHighestPriorityElement(),s=[];n.list=EasyStar.Node.CLOSED_LIST,n.y>0&&s.push({instance:c[0],searchNode:n,x:0,y:-1,cost:r*p(n.x,n.y-1)}),n.x<t[0].length-1&&s.push({instance:c[0],searchNode:n,x:1,y:0,cost:r*p(n.x+1,n.y)}),n.y<t.length-1&&s.push({instance:c[0],searchNode:n,x:0,y:1,cost:r*p(n.x,n.y+1)}),n.x>0&&s.push({instance:c[0],searchNode:n,x:-1,y:0,cost:r*p(n.x-1,n.y)}),d&&(n.x>0&&n.y>0&&(h||g(t,a,n.x,n.y-1)&&g(t,a,n.x-1,n.y))&&s.push({instance:c[0],searchNode:n,x:-1,y:-1,cost:i*p(n.x-1,n.y-1)}),n.x<t[0].length-1&&n.y<t.length-1&&(h||g(t,a,n.x,n.y+1)&&g(t,a,n.x+1,n.y))&&s.push({instance:c[0],searchNode:n,x:1,y:1,cost:i*p(n.x+1,n.y+1)}),n.x<t[0].length-1&&n.y>0&&(h||g(t,a,n.x,n.y-1)&&g(t,a,n.x+1,n.y))&&s.push({instance:c[0],searchNode:n,x:1,y:-1,cost:i*p(n.x+1,n.y-1)}),n.x>0&&n.y<t.length-1&&(h||g(t,a,n.x,n.y+1)&&g(t,a,n.x-1,n.y))&&s.push({instance:c[0],searchNode:n,x:-1,y:1,cost:i*p(n.x-1,n.y+1)})),s.sort(function(t,e){return t.cost<e.cost?-1:t.cost===e.cost?0:1});for(var l=!1,y=0;y<s.length;y++)if(f(s[y].instance,s[y].searchNode,s[y].x,s[y].y,s[y].cost),s[y].instance.isDoneCalculating===!0){l=!0;break}l&&c.shift()}else{var v=c[0];v.callback(null),c.shift()}}};var f=function(e,r,i,o,s){var l=r.x+i,h=r.y+o;if(void 0===n[l+"_"+h]){if(e.endX===l&&e.endY===h){e.isDoneCalculating=!0;var c=[],u=0;c[u]={x:l,y:h},u++,c[u]={x:r.x,y:r.y},u++;for(var d=r.parent;null!=d;)c[u]={x:d.x,y:d.y},u++,d=d.parent;c.reverse();var f=e,p=c;f.callback(p)}if(g(t,a,l,h)){var v=y(e,l,h,r,s);void 0===v.list?(v.list=EasyStar.Node.OPEN_LIST,e.openList.insert(v)):v.list===EasyStar.Node.OPEN_LIST&&r.costSoFar+s<v.costSoFar&&(v.costSoFar=r.costSoFar+s,v.parent=r)}}},g=function(t,e,a,r){for(var i=0;i<e.length;i++)if(t[r][a]===e[i])return!0;return!1},p=function(e,a){return l[e+"_"+a]||s[t[a][e]]},y=function(t,e,a,r,i){if(void 0!==t.nodeHash[e+"_"+a])return t.nodeHash[e+"_"+a];var o=v(e,a,t.endX,t.endY);if(null!==r)var n=r.costSoFar+i;else n=o;var s=new EasyStar.Node(r,e,a,n,o);return t.nodeHash[e+"_"+a]=s,s},v=function(t,e,a,r){return Math.sqrt((a-=t)*a+(r-=e)*r)}};